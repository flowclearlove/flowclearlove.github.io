{
    "version": "https://jsonfeed.org/version/1",
    "title": "让风听见 • All posts by \"问题解决\" category",
    "description": "人生不可能总是顺心如意的，但是持续朝着阳光走，影子就会躲在后面。刺眼，却表明对的方向。",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2023/05/14/%E8%AF%AD%E9%9B%80%E4%B8%80%E9%94%AE%E5%AF%BC%E5%87%BAmarkdown/",
            "url": "http://example.com/2023/05/14/%E8%AF%AD%E9%9B%80%E4%B8%80%E9%94%AE%E5%AF%BC%E5%87%BAmarkdown/",
            "title": "语雀一键导出markdown",
            "date_published": "2023-05-14T06:03:27.000Z",
            "content_html": "<h2 id=\"安装python\"><a href=\"#安装python\" class=\"headerlink\" title=\"安装python\"></a>安装python</h2><p><img src=\"image-20230514140518058.png\" alt=\"image-20230514140518058\"></p>\n<h2 id=\"pip安装库\"><a href=\"#pip安装库\" class=\"headerlink\" title=\"pip安装库\"></a>pip安装库</h2><figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs cmake\">pip3 <span class=\"hljs-keyword\">install</span> requests psutil<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"执行脚本\"><a href=\"#执行脚本\" class=\"headerlink\" title=\"执行脚本\"></a>执行脚本</h2><figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vim\"><span class=\"hljs-keyword\">python3</span> yuque.<span class=\"hljs-keyword\">py</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs py\"><span class=\"hljs-keyword\">import</span> json<br><span class=\"hljs-keyword\">import</span> sys<br><span class=\"hljs-keyword\">import</span> os<br><span class=\"hljs-keyword\">import</span> re<br><span class=\"hljs-keyword\">import</span> requests<br><span class=\"hljs-keyword\">import</span> psutil<br><span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime<br><br><span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">getattr</span>(sys, <span class=\"hljs-string\">&#x27;frozen&#x27;</span>, <span class=\"hljs-literal\">False</span>):<br>    APPLICATION_PATH = os.path.dirname(sys.executable)<br><span class=\"hljs-keyword\">else</span>:<br>    APPLICATION_PATH = os.path.dirname(<span class=\"hljs-string\">&#x27;.&#x27;</span>)x<br><span class=\"hljs-built_in\">print</span>(APPLICATION_PATH)<br>jsonConfig = json.load(<span class=\"hljs-built_in\">open</span>(os.path.join(APPLICATION_PATH, <span class=\"hljs-string\">&quot;config.json&quot;</span>), encoding=<span class=\"hljs-string\">&#x27;utf-8&#x27;</span>))<br><br><br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ExportYueQueDoc</span>:<br>    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self</span>):<br>        <span class=\"hljs-keyword\">try</span>:<br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">getattr</span>(sys, <span class=\"hljs-string\">&#x27;frozen&#x27;</span>, <span class=\"hljs-literal\">False</span>):<br>                APPLICATION_PATH = os.path.dirname(sys.executable)<br>            <span class=\"hljs-keyword\">else</span>:<br>                APPLICATION_PATH = os.path.dirname(<span class=\"hljs-string\">&#x27;.&#x27;</span>)<br>            self.jsonConfig = json.load(<span class=\"hljs-built_in\">open</span>(os.path.join(APPLICATION_PATH, <span class=\"hljs-string\">&quot;config.json&quot;</span>), encoding=<span class=\"hljs-string\">&#x27;utf-8&#x27;</span>))<br>            self.base_url = self.jsonConfig[<span class=\"hljs-string\">&#x27;BASE_URL&#x27;</span>]<br>            self.token = self.jsonConfig[<span class=\"hljs-string\">&#x27;TOKEN&#x27;</span>]<br>            self.headers = &#123;<br>                <span class=\"hljs-string\">&quot;User-Agent&quot;</span>: self.jsonConfig[<span class=\"hljs-string\">&#x27;USER_AGENT&#x27;</span>],<br>                <span class=\"hljs-string\">&quot;X-Auth-Token&quot;</span>: self.jsonConfig[<span class=\"hljs-string\">&#x27;TOKEN&#x27;</span>]<br>            &#125;<br>            self.data_path = self.jsonConfig[<span class=\"hljs-string\">&#x27;DATA_PATH&#x27;</span>]<br>        <span class=\"hljs-keyword\">except</span>:<br>            <span class=\"hljs-keyword\">raise</span> ValueError(<span class=\"hljs-string\">&quot;config.json 有误&quot;</span>)<br><br>    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_user_info</span>(<span class=\"hljs-params\">self</span>):<br>        res_obj = requests.get(url=self.base_url + <span class=\"hljs-string\">&#x27;/user&#x27;</span>, headers=self.headers)<br>        <span class=\"hljs-keyword\">if</span> res_obj.status_code != <span class=\"hljs-number\">200</span>:<br>            <span class=\"hljs-keyword\">raise</span> ValueError(<span class=\"hljs-string\">&quot;Token 信息错误&quot;</span>)<br>        user_json = res_obj.json()<br>        self.login_id = user_json[<span class=\"hljs-string\">&#x27;data&#x27;</span>][<span class=\"hljs-string\">&#x27;login&#x27;</span>]<br>        self.uid = user_json[<span class=\"hljs-string\">&#x27;data&#x27;</span>][<span class=\"hljs-string\">&#x27;id&#x27;</span>]<br>        self.username = user_json[<span class=\"hljs-string\">&#x27;data&#x27;</span>][<span class=\"hljs-string\">&#x27;name&#x27;</span>]<br>        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;=========== 用户信息初始化成功 ==========&quot;</span>)<br><br>    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_repos_data</span>(<span class=\"hljs-params\">self</span>):<br>        repos_json = requests.get(self.base_url + <span class=\"hljs-string\">&#x27;/users/&#x27;</span> + self.login_id + <span class=\"hljs-string\">&#x27;/repos&#x27;</span>, headers=self.headers).json()<br>        repos_list = []<br>        <span class=\"hljs-keyword\">for</span> item <span class=\"hljs-keyword\">in</span> repos_json[<span class=\"hljs-string\">&#x27;data&#x27;</span>]:<br>            rid = item[<span class=\"hljs-string\">&#x27;id&#x27;</span>]  <span class=\"hljs-comment\"># 知识库id</span><br>            name = item[<span class=\"hljs-string\">&#x27;name&#x27;</span>]  <span class=\"hljs-comment\"># 知识库名称</span><br>            repos_list.append(&#123;<span class=\"hljs-string\">&quot;rid&quot;</span>: rid, <span class=\"hljs-string\">&quot;repos_name&quot;</span>: name&#125;)<br>        <span class=\"hljs-keyword\">return</span> repos_list<br><br>    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_article_data</span>(<span class=\"hljs-params\">self, repos_list</span>):<br>        <span class=\"hljs-string\">&quot;&quot;&quot;获取文章数据&quot;&quot;&quot;</span><br>        article_list = []<br>        <span class=\"hljs-keyword\">for</span> repos <span class=\"hljs-keyword\">in</span> repos_list:<br>            article_datas = requests.get(self.base_url + <span class=\"hljs-string\">&#x27;/repos/&#x27;</span> + <span class=\"hljs-built_in\">str</span>(repos[<span class=\"hljs-string\">&#x27;rid&#x27;</span>]) + <span class=\"hljs-string\">&#x27;/docs&#x27;</span>,<br>                                         headers=self.headers).json()<br>            <span class=\"hljs-keyword\">for</span> item <span class=\"hljs-keyword\">in</span> article_datas[<span class=\"hljs-string\">&#x27;data&#x27;</span>]:<br>                bid = repos[<span class=\"hljs-string\">&#x27;rid&#x27;</span>]<br>                title = item[<span class=\"hljs-string\">&#x27;title&#x27;</span>]  <span class=\"hljs-comment\"># 文章标题</span><br>                desc = item[<span class=\"hljs-string\">&#x27;description&#x27;</span>]<br>                slug = item[<span class=\"hljs-string\">&#x27;slug&#x27;</span>]<br>                article_list.append(<br>                    &#123;<span class=\"hljs-string\">&quot;bid&quot;</span>: bid, <span class=\"hljs-string\">&quot;title&quot;</span>: title, <span class=\"hljs-string\">&quot;desc&quot;</span>: desc, <span class=\"hljs-string\">&quot;slug&quot;</span>: slug, <span class=\"hljs-string\">&quot;repos_name&quot;</span>: repos[<span class=\"hljs-string\">&quot;repos_name&quot;</span>]&#125;)<br><br>        <span class=\"hljs-keyword\">for</span> item <span class=\"hljs-keyword\">in</span> article_list:<br>            per_article_data = requests.get(self.base_url + <span class=\"hljs-string\">&#x27;/repos/&#x27;</span> + <span class=\"hljs-built_in\">str</span>(item[<span class=\"hljs-string\">&#x27;bid&#x27;</span>]) + <span class=\"hljs-string\">&#x27;/docs/&#x27;</span> + item[<span class=\"hljs-string\">&#x27;slug&#x27;</span>],<br>                                            headers=self.headers).json()<br>            posts_text = re.sub(<span class=\"hljs-string\">r&#x27;\\\\n&#x27;</span>, <span class=\"hljs-string\">&quot;\\n&quot;</span>, per_article_data[<span class=\"hljs-string\">&#x27;data&#x27;</span>][<span class=\"hljs-string\">&#x27;body&#x27;</span>])<br>            result = re.sub(<span class=\"hljs-string\">r&#x27;&lt;a name=&quot;(.*)&quot;&gt;&lt;/a&gt;&#x27;</span>, <span class=\"hljs-string\">&quot;&quot;</span>, posts_text)<br>            <span class=\"hljs-comment\"># all_datas.append(&#123;&quot;title&quot;: item[&#x27;title&#x27;], &quot;content&quot;: result&#125;)</span><br>            <span class=\"hljs-keyword\">yield</span> result, item[<span class=\"hljs-string\">&quot;repos_name&quot;</span>], item[<span class=\"hljs-string\">&#x27;title&#x27;</span>]<br><br>    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">save_article</span>(<span class=\"hljs-params\">self, result, repos_name, title</span>):<br>        current_time = datetime.now().strftime(<span class=\"hljs-string\">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)<br>        dir_path = <span class=\"hljs-string\">f&quot;<span class=\"hljs-subst\">&#123;self.data_path&#125;</span>/<span class=\"hljs-subst\">&#123;repos_name&#125;</span>&quot;</span><br>        dir_path = dir_path.replace(<span class=\"hljs-string\">&quot;.&quot;</span>,<span class=\"hljs-string\">&quot;_&quot;</span>)<br>        filepath = dir_path + <span class=\"hljs-string\">f&quot;/<span class=\"hljs-subst\">&#123;title&#125;</span>.md&quot;</span><br>        dir_ret = os.path.exists(dir_path)<br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> dir_ret:<br>            os.makedirs(dir_path)<br>            <span class=\"hljs-comment\">#exists_ret = os.path.exists(filepath)</span><br>        <span class=\"hljs-keyword\">try</span>:<br>            <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(filepath, <span class=\"hljs-string\">&#x27;a&#x27;</span>, encoding=<span class=\"hljs-string\">&quot;utf-8&quot;</span>) <span class=\"hljs-keyword\">as</span> fp:<br>                fp.writelines(result)<br>                <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;[<span class=\"hljs-subst\">&#123;current_time&#125;</span>]  <span class=\"hljs-subst\">&#123;title&#125;</span> 导出完成&quot;</span>)<br>        <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:<br>            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;[<span class=\"hljs-subst\">&#123;current_time&#125;</span>]  <span class=\"hljs-subst\">&#123;title&#125;</span> 导出失败&quot;</span>)<br><br>    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">main</span>(<span class=\"hljs-params\">self</span>):<br>        self.get_user_info()<br>        repos_list = self.get_repos_data()<br>        gen_obj = self.get_article_data(repos_list)<br>        <span class=\"hljs-keyword\">for</span> item <span class=\"hljs-keyword\">in</span> gen_obj:<br>            self.save_article(item[<span class=\"hljs-number\">0</span>], item[<span class=\"hljs-number\">1</span>], item[<span class=\"hljs-number\">2</span>])<br><br><br><span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:<br>    yq = ExportYueQueDoc()<br>    yq.main()<br></code></pre></td></tr></table></figure>\n\n",
            "tags": [
                "语雀"
            ]
        },
        {
            "id": "http://example.com/2023/05/14/%E9%98%BF%E9%87%8C%E4%BA%91%E6%90%AD%E5%BB%BAwebdev%EF%BC%88docker%EF%BC%89/",
            "url": "http://example.com/2023/05/14/%E9%98%BF%E9%87%8C%E4%BA%91%E6%90%AD%E5%BB%BAwebdev%EF%BC%88docker%EF%BC%89/",
            "title": "阿里云搭建webdev（docker）",
            "date_published": "2023-05-14T05:31:47.000Z",
            "content_html": "<h2 id=\"基础条件\"><a class=\"markdownIt-Anchor\" href=\"#基础条件\">#</a> 基础条件</h2>\n<p>使用 docker 快速为 joplin 搭建 WebDAV 服务<br>\n 1. 前提条件</p>\n<blockquote>\n<p>有自己的服务器，有可以访问的域名或 ip<br>\n 服务器上已经安装好 docker 和 docker-compose<br>\n 自己电脑上或手机上已经安装好 joplin 软件</p>\n</blockquote>\n<h2 id=\"配置\"><a class=\"markdownIt-Anchor\" href=\"#配置\">#</a> 配置</h2>\n<p>配置信息 (可根据自己实际情况调整)：</p>\n<ol>\n<li>监听端口: 22300</li>\n<li>访问域名: <a href=\"http://xxxx.com\">http://xxxx.com</a></li>\n<li>数据目录: /data/dav</li>\n<li>配置文件: /data/joplin.yml</li>\n</ol>\n<p>/data/joplin.yml 文件，内容如下:</p>\n<figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dts\"><span class=\"hljs-symbol\">version:</span> <span class=\"hljs-string\">&#x27;3&#x27;</span><br><span class=\"hljs-symbol\">services:</span><br><span class=\"hljs-symbol\">  webdav:</span><br><span class=\"hljs-symbol\">    image:</span> bytemark/webdav<br><span class=\"hljs-symbol\">    container_name:</span> webdav1<br><span class=\"hljs-symbol\">    restart:</span> always<br><span class=\"hljs-symbol\">    ports:</span><br>      - <span class=\"hljs-string\">&quot;22300:80&quot;</span><br><span class=\"hljs-symbol\">    environment:</span><br><span class=\"hljs-symbol\">      SERVER_NAMES:</span> 域名或者IP<br><span class=\"hljs-symbol\">      AUTH_TYPE:</span> Basic<br><span class=\"hljs-symbol\">      USERNAME:</span> webdev 账户名字<br><span class=\"hljs-symbol\">      PASSWORD:</span> webdev 用户密码<br><span class=\"hljs-symbol\">    volumes:</span><br>      - <span class=\"hljs-keyword\">/data/</span>dav:<span class=\"hljs-keyword\">/var/</span>lib/dav  数据保存位置<br><br></code></pre></td></tr></table></figure>\n<p><code>docker-compose -f /data/joplin.yml up -d</code>  启动</p>\n<h2 id=\"joplin配置\"><a class=\"markdownIt-Anchor\" href=\"#joplin配置\">#</a> joplin 配置</h2>\n<p><img src=\"image-20230514133632334.png\" alt=\"image-20230514133632334\"></p>\n",
            "tags": [
                "joplin"
            ]
        },
        {
            "id": "http://example.com/2023/05/13/hexo%E5%9B%BE%E7%89%87%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/",
            "url": "http://example.com/2023/05/13/hexo%E5%9B%BE%E7%89%87%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/",
            "title": "hexo图片问题解决",
            "date_published": "2023-05-13T02:52:41.000Z",
            "content_html": "<h2 id=\"1-typora设置\"><a href=\"#1-typora设置\" class=\"headerlink\" title=\"1.typora设置\"></a>1.typora设置</h2><p><img src=\"image-20230513105354056.png\" alt=\"image-20230513105354056\"></p>\n<h2 id=\"2-安装插件\"><a href=\"#2-安装插件\" class=\"headerlink\" title=\"2.安装插件\"></a>2.安装插件</h2><figure class=\"highlight maxima\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs maxima\">npm install hexo-asset-<span class=\"hljs-built_in\">image</span> --<span class=\"hljs-built_in\">save</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"3-修改hexo-asset-image配置\"><a href=\"#3-修改hexo-asset-image配置\" class=\"headerlink\" title=\"3.修改hexo-asset-image配置\"></a>3.修改hexo-asset-image配置</h2><blockquote>\n<p>直接贴上配置文件</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-meta\">&#x27;use strict&#x27;</span>;<br><span class=\"hljs-keyword\">var</span> cheerio = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;cheerio&#x27;</span>);<br><br><span class=\"hljs-comment\">// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string</span><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getPosition</span>(<span class=\"hljs-params\">str, m, i</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> str.<span class=\"hljs-title function_\">split</span>(m, i).<span class=\"hljs-title function_\">join</span>(m).<span class=\"hljs-property\">length</span>;<br>&#125;<br><br>hexo.<span class=\"hljs-property\">extend</span>.<span class=\"hljs-property\">filter</span>.<span class=\"hljs-title function_\">register</span>(<span class=\"hljs-string\">&#x27;after_post_render&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">data</span>)&#123;<br>  <span class=\"hljs-keyword\">var</span> config = hexo.<span class=\"hljs-property\">config</span>;<br>  <span class=\"hljs-keyword\">if</span>(config.<span class=\"hljs-property\">post_asset_folder</span>)&#123;<br>    <span class=\"hljs-keyword\">var</span> link = data.<span class=\"hljs-property\">permalink</span>;<br>    <span class=\"hljs-keyword\">var</span> beginPos = <span class=\"hljs-title function_\">getPosition</span>(link, <span class=\"hljs-string\">&#x27;/&#x27;</span>, <span class=\"hljs-number\">3</span>) + <span class=\"hljs-number\">1</span>;<br>    <span class=\"hljs-keyword\">var</span> appendLink = <span class=\"hljs-string\">&#x27;&#x27;</span>;<br>    <span class=\"hljs-comment\">// In hexo 3.1.1, the permalink of &quot;about&quot; page is like &quot;.../about/index.html&quot;.</span><br>    <span class=\"hljs-comment\">// if not with index.html endpos = link.lastIndexOf(&#x27;.&#x27;) + 1 support hexo-abbrlink</span><br>    <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-regexp\">/.*\\/index\\.html$/</span>.<span class=\"hljs-title function_\">test</span>(link)) &#123;<br>      <span class=\"hljs-comment\">// when permalink is end with index.html, for example 2019/02/20/xxtitle/index.html</span><br>      <span class=\"hljs-comment\">// image in xxtitle/ will go to xxtitle/index/</span><br>      appendLink = <span class=\"hljs-string\">&#x27;index/&#x27;</span>;<br>      <span class=\"hljs-keyword\">var</span> endPos = link.<span class=\"hljs-title function_\">lastIndexOf</span>(<span class=\"hljs-string\">&#x27;/&#x27;</span>);<br>    &#125;<br>    <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-keyword\">var</span> endPos = link.<span class=\"hljs-title function_\">lastIndexOf</span>(<span class=\"hljs-string\">&#x27;.&#x27;</span>);<br>    &#125;<br>    link = link.<span class=\"hljs-title function_\">substring</span>(beginPos, endPos) + <span class=\"hljs-string\">&#x27;/&#x27;</span> + appendLink;<br><br>    <span class=\"hljs-keyword\">var</span> toprocess = [<span class=\"hljs-string\">&#x27;excerpt&#x27;</span>, <span class=\"hljs-string\">&#x27;more&#x27;</span>, <span class=\"hljs-string\">&#x27;content&#x27;</span>];<br>    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">var</span> i = <span class=\"hljs-number\">0</span>; i &lt; toprocess.<span class=\"hljs-property\">length</span>; i++)&#123;<br>      <span class=\"hljs-keyword\">var</span> key = toprocess[i];<br><br>      <span class=\"hljs-keyword\">var</span> $ = cheerio.<span class=\"hljs-title function_\">load</span>(data[key], &#123;<br>        <span class=\"hljs-attr\">ignoreWhitespace</span>: <span class=\"hljs-literal\">false</span>,<br>        <span class=\"hljs-attr\">xmlMode</span>: <span class=\"hljs-literal\">false</span>,<br>        <span class=\"hljs-attr\">lowerCaseTags</span>: <span class=\"hljs-literal\">false</span>,<br>        <span class=\"hljs-attr\">decodeEntities</span>: <span class=\"hljs-literal\">false</span><br>      &#125;);<br><br>      $(<span class=\"hljs-string\">&#x27;img&#x27;</span>).<span class=\"hljs-title function_\">each</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;<br>        <span class=\"hljs-keyword\">if</span> ($(<span class=\"hljs-variable language_\">this</span>).<span class=\"hljs-title function_\">attr</span>(<span class=\"hljs-string\">&#x27;src&#x27;</span>))&#123;<br>          <span class=\"hljs-comment\">// For windows style path, we replace &#x27;\\&#x27; to &#x27;/&#x27;.</span><br>          <span class=\"hljs-keyword\">var</span> src = $(<span class=\"hljs-variable language_\">this</span>).<span class=\"hljs-title function_\">attr</span>(<span class=\"hljs-string\">&#x27;src&#x27;</span>).<span class=\"hljs-title function_\">replace</span>(<span class=\"hljs-string\">&#x27;\\\\&#x27;</span>, <span class=\"hljs-string\">&#x27;/&#x27;</span>);<br>          <span class=\"hljs-keyword\">if</span>(!(<span class=\"hljs-regexp\">/http[s]*.*|\\/\\/.*/</span>.<span class=\"hljs-title function_\">test</span>(src)<br>            || <span class=\"hljs-regexp\">/^\\s+\\//</span>.<span class=\"hljs-title function_\">test</span>(src)<br>            || <span class=\"hljs-regexp\">/^\\s*\\/uploads|images\\//</span>.<span class=\"hljs-title function_\">test</span>(src))) &#123;<br>            <span class=\"hljs-comment\">// For &quot;about&quot; page, the first part of &quot;src&quot; can&#x27;t be removed.</span><br>            <span class=\"hljs-comment\">// In addition, to support multi-level local directory.</span><br>            <span class=\"hljs-keyword\">var</span> linkArray = link.<span class=\"hljs-title function_\">split</span>(<span class=\"hljs-string\">&#x27;/&#x27;</span>).<span class=\"hljs-title function_\">filter</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">elem</span>)&#123;<br>              <span class=\"hljs-keyword\">return</span> elem != <span class=\"hljs-string\">&#x27;&#x27;</span>;<br>            &#125;);<br>            <span class=\"hljs-keyword\">var</span> srcArray = src.<span class=\"hljs-title function_\">split</span>(<span class=\"hljs-string\">&#x27;/&#x27;</span>).<span class=\"hljs-title function_\">filter</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">elem</span>)&#123;<br>              <span class=\"hljs-keyword\">return</span> elem != <span class=\"hljs-string\">&#x27;&#x27;</span> &amp;&amp; elem != <span class=\"hljs-string\">&#x27;.&#x27;</span>;<br>            &#125;);<br>            <span class=\"hljs-keyword\">if</span>(srcArray.<span class=\"hljs-property\">length</span> &gt; <span class=\"hljs-number\">1</span>)<br>            srcArray.<span class=\"hljs-title function_\">shift</span>();<br>            src = srcArray.<span class=\"hljs-title function_\">join</span>(<span class=\"hljs-string\">&#x27;/&#x27;</span>);<br><br>            $(<span class=\"hljs-variable language_\">this</span>).<span class=\"hljs-title function_\">attr</span>(<span class=\"hljs-string\">&#x27;src&#x27;</span>, src);<br>            <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-property\">info</span>&amp;&amp;<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">info</span>(<span class=\"hljs-string\">&quot;update link as:--&gt;&quot;</span>+config.<span class=\"hljs-property\">root</span> + link + src);<br>          &#125;<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>          <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-property\">info</span>&amp;&amp;<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">info</span>(<span class=\"hljs-string\">&quot;no src attr, skipped...&quot;</span>);<br>          <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-property\">info</span>&amp;&amp;<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">info</span>($(<span class=\"hljs-variable language_\">this</span>));<br>        &#125;<br>      &#125;);<br>      data[key] = $.<span class=\"hljs-title function_\">html</span>();<br>    &#125;<br>  &#125;<br>&#125;);<br><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"4-替换图片链接\"><a href=\"#4-替换图片链接\" class=\"headerlink\" title=\"4.替换图片链接\"></a>4.替换图片链接</h2><blockquote>\n<p>替换图片链接是最简单的解决办法</p>\n</blockquote>\n<p>ctrl+h打开全局替换</p>\n<p>这里我截个图测试一下</p>\n<p><img src=\"image-20230513105814898.png\" alt=\"image-20230513105814898\"></p>\n<p><img src=\"image-20230513105850650.png\" alt=\"image-20230513105850650\"></p>\n<p><img src=\"image-20230513105854808.png\" alt=\"image-20230513105854808\"></p>\n<h2 id=\"5-执行命令\"><a href=\"#5-执行命令\" class=\"headerlink\" title=\"5.执行命令\"></a>5.执行命令</h2><figure class=\"highlight ebnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ebnf\"><span class=\"hljs-attribute\">hexo d -g</span><br></code></pre></td></tr></table></figure>\n\n\n\n",
            "tags": [
                "hexo博客"
            ]
        },
        {
            "id": "http://example.com/2023/05/10/nginx%E9%85%8D%E7%BD%AETCP-UDP%E8%BD%AC%E5%8F%91/",
            "url": "http://example.com/2023/05/10/nginx%E9%85%8D%E7%BD%AETCP-UDP%E8%BD%AC%E5%8F%91/",
            "title": "nginx配置TCP/UDP转发",
            "date_published": "2023-05-10T12:36:24.000Z",
            "content_html": "<h2 id=\"实现代码\"><a class=\"markdownIt-Anchor\" href=\"#实现代码\">#</a> 实现代码</h2>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-section\">stream</span> &#123;<br>    <span class=\"hljs-comment\">#将12345端口转发到192.168.1.23的3306端口</span><br>    <span class=\"hljs-section\">server</span> &#123;<br>        <span class=\"hljs-attribute\">listen</span> <span class=\"hljs-number\">12345</span>;<br>        <span class=\"hljs-attribute\">proxy_connect_timeout</span> <span class=\"hljs-number\">5s</span>;<br>        <span class=\"hljs-attribute\">proxy_timeout</span> <span class=\"hljs-number\">20s</span>;<br>        <span class=\"hljs-attribute\">proxy_pass</span> <span class=\"hljs-number\">192.168.1.23:3306</span>;<br>    &#125;<br>    <span class=\"hljs-comment\">#将udp 53端口转发到192.168.1.23 53端口</span><br>    <span class=\"hljs-section\">server</span> &#123;<br>        <span class=\"hljs-attribute\">listen</span> <span class=\"hljs-number\">53</span> udp reuseport;<br>        <span class=\"hljs-attribute\">proxy_timeout</span> <span class=\"hljs-number\">20s</span>;<br>        <span class=\"hljs-attribute\">proxy_pass</span> <span class=\"hljs-number\">192.168.1.23:53</span>;<br>    &#125;<br>    <span class=\"hljs-comment\">#ipv4转发到ipv6</span><br>    <span class=\"hljs-section\">server</span> &#123;<br>        <span class=\"hljs-attribute\">listen</span> <span class=\"hljs-number\">9135</span>;<br>        <span class=\"hljs-attribute\">proxy_connect_timeout</span> <span class=\"hljs-number\">10s</span>;<br>        <span class=\"hljs-attribute\">proxy_timeout</span> <span class=\"hljs-number\">30s</span>;<br>        <span class=\"hljs-attribute\">proxy_pass</span> [<span class=\"hljs-number\">2607</span>:fcd0:<span class=\"hljs-number\">107</span>:3cc::<span class=\"hljs-number\">1</span>]:<span class=\"hljs-number\">9135</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n<h2 id=\"前提\"><a class=\"markdownIt-Anchor\" href=\"#前提\">#</a> 前提</h2>\n<blockquote>\n<p>版本一定要大于 1.9.1，编译的时候需要–with-stream 这个模块支持。</p>\n</blockquote>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\"><span class=\"hljs-comment\">#执行下面的命令，根据提示完成安装</span><br>wget https:<span class=\"hljs-regexp\">//</span>raw.githubusercontent.com<span class=\"hljs-regexp\">/helloxz/</span>nginx-cdn<span class=\"hljs-regexp\">/master/</span>nginx.sh &amp;&amp; bash nginx.sh<br><span class=\"hljs-comment\">#安装完成后执行下面的命令让环境变量生效</span><br>source <span class=\"hljs-regexp\">/etc/</span>profile<br><span class=\"hljs-comment\">#执行下面的命令查看nginx信息</span><br>nginx -V<br></code></pre></td></tr></table></figure>\n",
            "tags": [
                "开发"
            ]
        }
    ]
}