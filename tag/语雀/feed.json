{
    "version": "https://jsonfeed.org/version/1",
    "title": "让风听见 • All posts by \"语雀\" tag",
    "description": "人生不可能总是顺心如意的，但是持续朝着阳光走，影子就会躲在后面。刺眼，却表明对的方向。",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2023/05/14/%E8%AF%AD%E9%9B%80%E4%B8%80%E9%94%AE%E5%AF%BC%E5%87%BAmarkdown/",
            "url": "http://example.com/2023/05/14/%E8%AF%AD%E9%9B%80%E4%B8%80%E9%94%AE%E5%AF%BC%E5%87%BAmarkdown/",
            "title": "语雀一键导出markdown",
            "date_published": "2023-05-14T06:03:27.000Z",
            "content_html": "<h2 id=\"安装python\"><a href=\"#安装python\" class=\"headerlink\" title=\"安装python\"></a>安装python</h2><p><img src=\"image-20230514140518058.png\" alt=\"image-20230514140518058\"></p>\n<h2 id=\"pip安装库\"><a href=\"#pip安装库\" class=\"headerlink\" title=\"pip安装库\"></a>pip安装库</h2><figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs cmake\">pip3 <span class=\"hljs-keyword\">install</span> requests psutil<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"执行脚本\"><a href=\"#执行脚本\" class=\"headerlink\" title=\"执行脚本\"></a>执行脚本</h2><figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vim\"><span class=\"hljs-keyword\">python3</span> yuque.<span class=\"hljs-keyword\">py</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs py\"><span class=\"hljs-keyword\">import</span> json<br><span class=\"hljs-keyword\">import</span> sys<br><span class=\"hljs-keyword\">import</span> os<br><span class=\"hljs-keyword\">import</span> re<br><span class=\"hljs-keyword\">import</span> requests<br><span class=\"hljs-keyword\">import</span> psutil<br><span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime<br><br><span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">getattr</span>(sys, <span class=\"hljs-string\">&#x27;frozen&#x27;</span>, <span class=\"hljs-literal\">False</span>):<br>    APPLICATION_PATH = os.path.dirname(sys.executable)<br><span class=\"hljs-keyword\">else</span>:<br>    APPLICATION_PATH = os.path.dirname(<span class=\"hljs-string\">&#x27;.&#x27;</span>)x<br><span class=\"hljs-built_in\">print</span>(APPLICATION_PATH)<br>jsonConfig = json.load(<span class=\"hljs-built_in\">open</span>(os.path.join(APPLICATION_PATH, <span class=\"hljs-string\">&quot;config.json&quot;</span>), encoding=<span class=\"hljs-string\">&#x27;utf-8&#x27;</span>))<br><br><br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ExportYueQueDoc</span>:<br>    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self</span>):<br>        <span class=\"hljs-keyword\">try</span>:<br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">getattr</span>(sys, <span class=\"hljs-string\">&#x27;frozen&#x27;</span>, <span class=\"hljs-literal\">False</span>):<br>                APPLICATION_PATH = os.path.dirname(sys.executable)<br>            <span class=\"hljs-keyword\">else</span>:<br>                APPLICATION_PATH = os.path.dirname(<span class=\"hljs-string\">&#x27;.&#x27;</span>)<br>            self.jsonConfig = json.load(<span class=\"hljs-built_in\">open</span>(os.path.join(APPLICATION_PATH, <span class=\"hljs-string\">&quot;config.json&quot;</span>), encoding=<span class=\"hljs-string\">&#x27;utf-8&#x27;</span>))<br>            self.base_url = self.jsonConfig[<span class=\"hljs-string\">&#x27;BASE_URL&#x27;</span>]<br>            self.token = self.jsonConfig[<span class=\"hljs-string\">&#x27;TOKEN&#x27;</span>]<br>            self.headers = &#123;<br>                <span class=\"hljs-string\">&quot;User-Agent&quot;</span>: self.jsonConfig[<span class=\"hljs-string\">&#x27;USER_AGENT&#x27;</span>],<br>                <span class=\"hljs-string\">&quot;X-Auth-Token&quot;</span>: self.jsonConfig[<span class=\"hljs-string\">&#x27;TOKEN&#x27;</span>]<br>            &#125;<br>            self.data_path = self.jsonConfig[<span class=\"hljs-string\">&#x27;DATA_PATH&#x27;</span>]<br>        <span class=\"hljs-keyword\">except</span>:<br>            <span class=\"hljs-keyword\">raise</span> ValueError(<span class=\"hljs-string\">&quot;config.json 有误&quot;</span>)<br><br>    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_user_info</span>(<span class=\"hljs-params\">self</span>):<br>        res_obj = requests.get(url=self.base_url + <span class=\"hljs-string\">&#x27;/user&#x27;</span>, headers=self.headers)<br>        <span class=\"hljs-keyword\">if</span> res_obj.status_code != <span class=\"hljs-number\">200</span>:<br>            <span class=\"hljs-keyword\">raise</span> ValueError(<span class=\"hljs-string\">&quot;Token 信息错误&quot;</span>)<br>        user_json = res_obj.json()<br>        self.login_id = user_json[<span class=\"hljs-string\">&#x27;data&#x27;</span>][<span class=\"hljs-string\">&#x27;login&#x27;</span>]<br>        self.uid = user_json[<span class=\"hljs-string\">&#x27;data&#x27;</span>][<span class=\"hljs-string\">&#x27;id&#x27;</span>]<br>        self.username = user_json[<span class=\"hljs-string\">&#x27;data&#x27;</span>][<span class=\"hljs-string\">&#x27;name&#x27;</span>]<br>        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;=========== 用户信息初始化成功 ==========&quot;</span>)<br><br>    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_repos_data</span>(<span class=\"hljs-params\">self</span>):<br>        repos_json = requests.get(self.base_url + <span class=\"hljs-string\">&#x27;/users/&#x27;</span> + self.login_id + <span class=\"hljs-string\">&#x27;/repos&#x27;</span>, headers=self.headers).json()<br>        repos_list = []<br>        <span class=\"hljs-keyword\">for</span> item <span class=\"hljs-keyword\">in</span> repos_json[<span class=\"hljs-string\">&#x27;data&#x27;</span>]:<br>            rid = item[<span class=\"hljs-string\">&#x27;id&#x27;</span>]  <span class=\"hljs-comment\"># 知识库id</span><br>            name = item[<span class=\"hljs-string\">&#x27;name&#x27;</span>]  <span class=\"hljs-comment\"># 知识库名称</span><br>            repos_list.append(&#123;<span class=\"hljs-string\">&quot;rid&quot;</span>: rid, <span class=\"hljs-string\">&quot;repos_name&quot;</span>: name&#125;)<br>        <span class=\"hljs-keyword\">return</span> repos_list<br><br>    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_article_data</span>(<span class=\"hljs-params\">self, repos_list</span>):<br>        <span class=\"hljs-string\">&quot;&quot;&quot;获取文章数据&quot;&quot;&quot;</span><br>        article_list = []<br>        <span class=\"hljs-keyword\">for</span> repos <span class=\"hljs-keyword\">in</span> repos_list:<br>            article_datas = requests.get(self.base_url + <span class=\"hljs-string\">&#x27;/repos/&#x27;</span> + <span class=\"hljs-built_in\">str</span>(repos[<span class=\"hljs-string\">&#x27;rid&#x27;</span>]) + <span class=\"hljs-string\">&#x27;/docs&#x27;</span>,<br>                                         headers=self.headers).json()<br>            <span class=\"hljs-keyword\">for</span> item <span class=\"hljs-keyword\">in</span> article_datas[<span class=\"hljs-string\">&#x27;data&#x27;</span>]:<br>                bid = repos[<span class=\"hljs-string\">&#x27;rid&#x27;</span>]<br>                title = item[<span class=\"hljs-string\">&#x27;title&#x27;</span>]  <span class=\"hljs-comment\"># 文章标题</span><br>                desc = item[<span class=\"hljs-string\">&#x27;description&#x27;</span>]<br>                slug = item[<span class=\"hljs-string\">&#x27;slug&#x27;</span>]<br>                article_list.append(<br>                    &#123;<span class=\"hljs-string\">&quot;bid&quot;</span>: bid, <span class=\"hljs-string\">&quot;title&quot;</span>: title, <span class=\"hljs-string\">&quot;desc&quot;</span>: desc, <span class=\"hljs-string\">&quot;slug&quot;</span>: slug, <span class=\"hljs-string\">&quot;repos_name&quot;</span>: repos[<span class=\"hljs-string\">&quot;repos_name&quot;</span>]&#125;)<br><br>        <span class=\"hljs-keyword\">for</span> item <span class=\"hljs-keyword\">in</span> article_list:<br>            per_article_data = requests.get(self.base_url + <span class=\"hljs-string\">&#x27;/repos/&#x27;</span> + <span class=\"hljs-built_in\">str</span>(item[<span class=\"hljs-string\">&#x27;bid&#x27;</span>]) + <span class=\"hljs-string\">&#x27;/docs/&#x27;</span> + item[<span class=\"hljs-string\">&#x27;slug&#x27;</span>],<br>                                            headers=self.headers).json()<br>            posts_text = re.sub(<span class=\"hljs-string\">r&#x27;\\\\n&#x27;</span>, <span class=\"hljs-string\">&quot;\\n&quot;</span>, per_article_data[<span class=\"hljs-string\">&#x27;data&#x27;</span>][<span class=\"hljs-string\">&#x27;body&#x27;</span>])<br>            result = re.sub(<span class=\"hljs-string\">r&#x27;&lt;a name=&quot;(.*)&quot;&gt;&lt;/a&gt;&#x27;</span>, <span class=\"hljs-string\">&quot;&quot;</span>, posts_text)<br>            <span class=\"hljs-comment\"># all_datas.append(&#123;&quot;title&quot;: item[&#x27;title&#x27;], &quot;content&quot;: result&#125;)</span><br>            <span class=\"hljs-keyword\">yield</span> result, item[<span class=\"hljs-string\">&quot;repos_name&quot;</span>], item[<span class=\"hljs-string\">&#x27;title&#x27;</span>]<br><br>    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">save_article</span>(<span class=\"hljs-params\">self, result, repos_name, title</span>):<br>        current_time = datetime.now().strftime(<span class=\"hljs-string\">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)<br>        dir_path = <span class=\"hljs-string\">f&quot;<span class=\"hljs-subst\">&#123;self.data_path&#125;</span>/<span class=\"hljs-subst\">&#123;repos_name&#125;</span>&quot;</span><br>        dir_path = dir_path.replace(<span class=\"hljs-string\">&quot;.&quot;</span>,<span class=\"hljs-string\">&quot;_&quot;</span>)<br>        filepath = dir_path + <span class=\"hljs-string\">f&quot;/<span class=\"hljs-subst\">&#123;title&#125;</span>.md&quot;</span><br>        dir_ret = os.path.exists(dir_path)<br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> dir_ret:<br>            os.makedirs(dir_path)<br>            <span class=\"hljs-comment\">#exists_ret = os.path.exists(filepath)</span><br>        <span class=\"hljs-keyword\">try</span>:<br>            <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(filepath, <span class=\"hljs-string\">&#x27;a&#x27;</span>, encoding=<span class=\"hljs-string\">&quot;utf-8&quot;</span>) <span class=\"hljs-keyword\">as</span> fp:<br>                fp.writelines(result)<br>                <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;[<span class=\"hljs-subst\">&#123;current_time&#125;</span>]  <span class=\"hljs-subst\">&#123;title&#125;</span> 导出完成&quot;</span>)<br>        <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:<br>            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;[<span class=\"hljs-subst\">&#123;current_time&#125;</span>]  <span class=\"hljs-subst\">&#123;title&#125;</span> 导出失败&quot;</span>)<br><br>    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">main</span>(<span class=\"hljs-params\">self</span>):<br>        self.get_user_info()<br>        repos_list = self.get_repos_data()<br>        gen_obj = self.get_article_data(repos_list)<br>        <span class=\"hljs-keyword\">for</span> item <span class=\"hljs-keyword\">in</span> gen_obj:<br>            self.save_article(item[<span class=\"hljs-number\">0</span>], item[<span class=\"hljs-number\">1</span>], item[<span class=\"hljs-number\">2</span>])<br><br><br><span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:<br>    yq = ExportYueQueDoc()<br>    yq.main()<br></code></pre></td></tr></table></figure>\n\n",
            "tags": [
                "语雀"
            ]
        }
    ]
}